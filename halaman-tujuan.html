<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Recorder</title>
    <style>
        body {

top: 0;
left: 0;
right: 0px;
z-index: 10;
overflow-x: hidden;
}

body {

background-image: linear-gradient(to right, #009999 0, #009999 0);
background: cover;
}

    
    button {
      background-color: #4CAF50; /* Warna latar belakang */
      border: none; /* Menghilangkan border */
      color: white; /* Warna teks */
      padding: 15px 32px; /* Jarak antara teks dengan border */
      text-align: center; /* Posisi teks */
      text-decoration: none; /* Menghilangkan underline */
      display: inline-block; /* Membuat button terlihat seperti sebuah blok */
      font-size: 16px; /* Ukuran teks */
      margin: 10px; /* Jarak antara button */
    }

    button:disabled {
      opacity: 0.5; /* Mengubah opasitas menjadi 50% saat tombol tidak bisa digunakan */
      cursor: not-allowed; /* Mengubah cursor saat tombol tidak bisa digunakan */
    }

    </style>
</head>
<body>
    <button id="startButton">Start Recording</button>
  <button id="stopButton" disabled>Stop Recording</button>
  <canvas id="canvas4"></canvas>
  

    <script>
 // Mendaftarkan elemen HTML
var startButton = document.getElementById("startButton");
var stopButton = document.getElementById("stopButton");
var canvas = document.getElementById("canvas4");
var canvasCtx = canvas.getContext("2d");

// Menambahkan event listener untuk tombol start
startButton.addEventListener('mousedown', () => {
    // Mengubah status tombol
    startButton.disabled = true;
    stopButton.disabled = false;

    // Menginisialisasi objek Web Audio API setelah pengguna memberikan tindakan pada halaman
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    var audioContext = new AudioContext();

    // Menginisialisasi objek MediaStream
    navigator.mediaDevices.getUserMedia({audio: true})
        .then(function(stream) {
            // Membuat source audio dari stream yang didapat
            var source = audioContext.createMediaStreamSource(stream);

            // Membuat objek analisis gelombang
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 2048;
            bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);

            // Menghubungkan source audio dengan analisis gelombang
            source.connect(analyser);

            // Memulai visualisasi
            draw();
        })
        .catch(function(err) {
            console.log('The following getUserMedia error occurred: ' + err);
        });
});

// Menambahkan event listener untuk tombol stop
stopButton.addEventListener('mousedown', function() {
    // Mengubah status tombol
    startButton.disabled = false;
    stopButton.disabled = true;

    // Menghentikan visualisasi
    cancelAnimationFrame(animationId);

    // Membuat objek AudioBuffer
    var audioBuffer = audioContext.createBuffer(1, bufferLength, audioContext.sampleRate);
    var audioData = audioBuffer.getChannelData(0);

    // Menambahkan data gelombang ke dalam buffer
    for (var i = 0; i < bufferLength; i++) {
        audioData[i] = (dataArray[i] - 128) / 128;
    }

    // Membuat objek AudioBufferSourceNode
    var audioSource = audioContext.createBufferSource();
    audioSource.buffer = audioBuffer;

    // Menghubungkan AudioBufferSourceNode ke output audio
    audioSource.connect(audioContext.destination);

    // Memainkan audio
    audioSource.start();

    // Membuat URL blob untuk audio
    var blob = new Blob([audioBuffer], {type: 'audio/wav'});
    var url = URL.createObjectURL(blob);

    // Memutarkan audio di elemen HTML audio
    var audioElement = document.getElementById('audioElement');
    audioElement.src = url;
    audioElement.play();
});

  // Variabel untuk menyimpan ID animasi
  var animationId;

  // Fungsi untuk menggambar grafik gelombang
  function draw() {
    // Membersihkan canvas sebelum menggambar
    canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

    // Menggambar grafik gelombang
    analyser.getByteTimeDomainData(dataArray);

    // Membersihkan konten pada canvas
    canvasCtx.fillStyle = 'transparent';
    canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

    // Mengatur properti canvas untuk menggambar grafik
    canvasCtx.lineWidth = 3;
    // Membuat gradient warna pada gelombang bulat
var gradient = canvasCtx.createLinearGradient(0, 0, canvas.width, 0);
gradient.addColorStop(0, '#4eb4e5'); // warna awal
gradient.addColorStop(0.5, '#ffeb3b'); // warna tengah
gradient.addColorStop(1, '#4eb4e5'); // warna akhir
canvasCtx.strokeStyle = gradient;

    canvasCtx.beginPath();

    var sliceWidth = canvas.width * 1.0 / bufferLength;
    var centerX = canvas.width / 2;
    var centerY = canvas.height / 2;
    var radius = 50;

    // Menggambar grafik gelombang
    for (var i = 0; i < bufferLength; i++) {
        var v = dataArray[i] / 128.0;
        var angle = i * (Math.PI * 2) / bufferLength;
        var x = centerX + Math.cos(angle) * (radius * v);
        var y = centerY + Math.sin(angle) * (radius * v);

        if (i === 0) {
            canvasCtx.moveTo(x, y);
        } else {
            canvasCtx.lineTo(x, y);
        }
    }

    canvasCtx.closePath();
    canvasCtx.stroke();

    // Meminta browser untuk menggambar lagi di frame berikutnya
    animationId = requestAnimationFrame(draw);
}

    </script>
   
</body>
</html>
